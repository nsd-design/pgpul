{% extends "../../pgpul_admin/base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}


<div class="col-lg-12">
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Créez une Faculté, un Département ou une Classe</h5>
      <!-- Accordion without outline borders -->
      <div class="accordion accordion-flush" id="accordionFlushExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="flush-headingOne">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
              Faculté
            </button>
          </h2>
          <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
            <!-- Create Faculty -->
            <h5 class="card-title lh-base">Créez une Facultés</h5>
            <form method="POST" action="/departement/fac/" class="row g-3 position-md-relative" id="fac_form">
              {% csrf_token %}
              <div class="col-md-4">
                <label for="id_nom_fac" class="form-label">Nom de la Faculté</label>
                {{ fac_form.nom_fac | as_crispy_field }}
              </div>
              <div class="col-12 col-md-4">
                <label for="id_code_fac" class="form-label">Code de la Faculté</label>
                {{ fac_form.code_fac | as_crispy_field }}
              </div>
              <div class="col-12 col-md-3 position-md-absolute top-md-0 mt-md-5 mb-3 end-md-0 translate-md-middle-y">
                <button class="btn btn-primary " type="submit">Créer</button>
              </div>
            </form>
            <!-- End Create Faculty -->
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="flush-headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
              Département
            </button>
          </h2>
          <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">
            <!-- Create Department -->
            <h5 class="card-title lh-base">Créez un Département</h5>
            <form method="POST" action="/departement/dept/" class="row g-3" id="dept_form">
              {% csrf_token %}
              <div class="col-md-3">
                <label for="id_nom_dept" class="form-label">Nom du Département</label>
                {{ dept_form.nom_dept | as_crispy_field}}
              </div>
              <div class="col-md-3">
                <label for="id_code_dept" class="form-label">Code du Département</label>
                {{ dept_form.code_dept | as_crispy_field}}
              </div>
              <div class="col-md-3">
                <label for="id_dept_fac" class="form-label">Faculté</label>
                {{ dept_form.dept_fac | as_crispy_field}}
              </div>
              <div class="col-12 col-md-3 position-md-absolute top-md-0 mt-md-5 mb-3 end-md-0 translate-md-middle-y">
                <button class="btn btn-primary" type="submit">Créer</button>
              </div>
            </form>
            <!-- End Create Department -->
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="flush-headingThree">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
              Classe
            </button>
          </h2>
          <div id="flush-collapseThree" class="accordion-collapse collapse" aria-labelledby="flush-headingThree" data-bs-parent="#accordionFlushExample">
            <!-- Create Classe -->
            <h5 class="card-title lh-base">Créez une Classe</h5>
            <form method="POST" action="/departement/classe/" class="row g-3" id="classe_form">
              {% csrf_token %}
              <div class="col-md-6">
                <label for="id_designation" class="form-label">Designation de la classe</label>
                {{ classe_form.designation | as_crispy_field }}
              </div>
              <div class="col-12 col-md-3 position-md-absolute top-md-0 mt-md-5 mb-3 end-md-0 translate-md-middle-y">
                <button class="btn btn-primary" type="submit">Créer</button>
              </div>
            </form>
            <!-- End Create Classe -->
          </div>
        </div>
      </div><!-- End Accordion without outline borders -->

    </div>
  </div>
</div>
<!-- Tableaux des enregistrements -->
<div class="row gx-5">
  <div class="card col-12">
      <div class="card-body">
        <h5 class="card-title">Bordered Tabs Justified</h5>

        <!-- Bordered Tabs Justified -->
        <ul class="nav nav-tabs nav-tabs-bordered d-flex" id="borderedTabJustified" role="tablist">
          <li class="nav-item flex-fill" role="presentation">
            <button class="nav-link w-100 active" id="home-tab" data-bs-toggle="tab" data-bs-target="#bordered-justified-home" type="button" role="tab" aria-controls="home" aria-selected="true">Facultés</button>
          </li>
          <li class="nav-item flex-fill" role="presentation">
            <button class="nav-link w-100" id="profile-tab" data-bs-toggle="tab" data-bs-target="#bordered-justified-profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Départements</button>
          </li>
          <li class="nav-item flex-fill" role="presentation">
            <button class="nav-link w-100" id="contact-tab" data-bs-toggle="tab" data-bs-target="#bordered-justified-contact" type="button" role="tab" aria-controls="contact" aria-selected="false">Classes</button>
          </li>
        </ul>
        <div class="tab-content pt-2" id="borderedTabJustifiedContent">
          <div class="tab-pane fade show active" id="bordered-justified-home" role="tabpanel" aria-labelledby="home-tab">
            <!-- Faculte -->
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Liste des Facultés</h5>

                  <!-- Table Faculté -->
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">Nom de la Faculté</th>
                        <th scope="col">Code de la Faculté</th>
                        {% comment %} <th scope="col">Age</th>
                        <th scope="col">Start Date</th> {% endcomment %}
                      </tr>
                    </thead>
                    <tbody>
                      {% for fac in facultes %}
                      <tr>
                        <th scope="row">1</th>
                        <td>{{ fac.nom_fac }}</td>
                        <td>{{ fac.code_fac }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                  <!-- End Table Faculté -->

                </div>
              </div>
            </div>
            <!-- End Faculte -->
          </div>
          <div class="tab-pane fade" id="bordered-justified-profile" role="tabpanel" aria-labelledby="profile-tab">
            <!-- Departement -->
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Liste des Département</h5>

                  <!-- Table Départements -->
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">Nom du Département</th>
                        <th scope="col">Code du Département</th>
                        <th scope="col">Faculté</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for dept in departements%}
                      <tr>
                        <th scope="row">1</th>
                        <td>{{ dept.nom_dept}}</td>
                        <td>{{ dept.code_dept}}</td>
                        <td>{{ dept.dept_fac}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                  <!-- End Table Départements -->

                </div>
              </div>
            </div>
            <!-- End Departement -->
          </div>
          <div class="tab-pane fade" id="bordered-justified-contact" role="tabpanel" aria-labelledby="contact-tab">
            <!-- Classes -->
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Liste des Classes</h5>

                  <!-- Table Classes -->
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">Designation de la Classe</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for classe in classes%}
                      <tr>
                        <th scope="row">1</th>
                        <td>{{ classe.designation }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                  <!-- End Table Classes -->

                </div>
              </div>
            </div>
            <!-- End Classes -->
          </div>
        </div><!-- End Bordered Tabs Justified -->
      </div>
  </div>
</div>
<!-- End Tableaux des enregistrements -->

{% endblock %}
{% block custom_js %}
<script>
  $(document).ready(function(){

    function save(url, form, msg){
      $.ajax({
        type: "POST",
        url: url,
        data: $(form).serialize(),
        success: function(data){
          if(data.success){
            alert(msg)
          }
          else if(data.exists.length > 0){
            console.log(data.exists)
          }
          else{
            console.log(data.errors)
          }

        },
      });
    }

    $("#fac_form").submit(function(e){
      e.preventDefault();
      $.ajax({
        type: "POST",
        url: "/departement/fac/",
        data: $(this).serialize(),
        success: function(data){
          if(data.success){
            alert("Faculte creee avec succes");
            $("#fac_form")[0].reset();
          }
          else if(data.exists.length > 0){
            console.log(data.exists);
          }
          else{
            console.log(data.errors)
          }
        },
      })
    })

    $("#dept_form").submit(function(evt){
      evt.preventDefault();
      $.ajax({
        type: "POST",
        url: "/departement/dept/",
        data: $(this).serialize(),
        success: function(data){
          if(data.success){
            alert("Departement cree avec succes")
            $("#dept_form")[0].reset();
          }
          else if(data.exists.length > 0){
            console.log(data.exists)
          }
          else{
            console.log(data.errors)
          }
        },
      });
    }); 

    $("#classe_form").submit(function(e){
      e.preventDefault();
      const url = "/departement/classe/";
      const msg = "Classe creee avec succes";
      const form = $(this);
      save(url, form, msg)
    });

  })
</script>
{% endblock %}